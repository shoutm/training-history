<% if @exercise_set %>
  <%
    exercises_data = @exercise_set.exercise_items.map do |item|
      { name: item.name, exerciseSeconds: item.exercise_seconds, restSeconds: item.rest_seconds }
    end
  %>
  <div class="max-w-md mx-auto p-4" data-controller="timer"
       data-timer-exercises-value="<%= exercises_data.to_json %>"
       data-timer-rounds-value="<%= @exercise_set.rounds %>">

    <!-- Header -->
    <div class="flex items-center mb-4">
      <%= link_to root_path, class: "p-2 hover:bg-gray-100 rounded" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      <% end %>
      <h1 class="text-xl font-bold flex-1 text-center mr-8"><%= @exercise_set.name %></h1>
    </div>

    <!-- Preset Selector -->
    <% if @exercise_sets.size > 1 %>
      <div class="mb-6">
        <select onchange="if(this.value) window.location.href=this.value"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          <% @exercise_sets.each do |es| %>
            <option value="<%= timer_with_set_path(es) %>" <%= es.id == @exercise_set.id ? "selected" : "" %>>
              <%= es.name %><%= es.default? ? " (default)" : "" %>
            </option>
          <% end %>
        </select>
      </div>
    <% end %>

    <!-- Timer Display -->
    <div class="bg-gray-100 rounded-2xl p-8 mb-6">
      <!-- Exercise name -->
      <div class="text-center mb-2">
        <span data-timer-target="exerciseName" class="text-lg font-semibold text-gray-700">
          <%= @exercise_set.exercise_items.first&.name %>
        </span>
      </div>

      <!-- Phase indicator -->
      <div class="text-center mb-4">
        <span data-timer-target="phase" class="inline-block px-4 py-1 rounded-full text-white font-semibold bg-green-500">
          Exercise
        </span>
      </div>

      <!-- Time display -->
      <div class="text-center">
        <span data-timer-target="display" class="text-7xl font-mono font-bold text-gray-800">
          00:<%= "%02d" % (@exercise_set.exercise_items.first&.exercise_seconds || 30) %>
        </span>
      </div>

      <!-- Round/Exercise info -->
      <div class="text-center mt-4">
        <span data-timer-target="roundInfo" class="text-xl text-gray-600">
          Round 1 / <%= @exercise_set.rounds %>
        </span>
        <span class="text-gray-400 mx-2">|</span>
        <span data-timer-target="exerciseInfo" class="text-xl text-gray-600">
          1 / <%= @exercise_set.exercise_items.size %>
        </span>
      </div>

      <!-- Progress bar -->
      <div class="mt-6 h-2 bg-gray-300 rounded-full overflow-hidden">
        <div data-timer-target="progress" class="h-full bg-blue-500 transition-all duration-1000" style="width: 0%"></div>
      </div>
    </div>

    <!-- Controls -->
    <div class="flex justify-center gap-4 mb-8">
      <button data-timer-target="startBtn" data-action="click->timer#start"
              class="px-8 py-4 bg-green-500 text-white font-bold text-lg rounded-xl hover:bg-green-600 transition-colors">
        Start
      </button>
      <button data-timer-target="pauseBtn" data-action="click->timer#pause"
              class="hidden px-8 py-4 bg-yellow-500 text-white font-bold text-lg rounded-xl hover:bg-yellow-600 transition-colors">
        Pause
      </button>
      <button data-timer-target="resetBtn" data-action="click->timer#reset"
              class="px-8 py-4 bg-gray-500 text-white font-bold text-lg rounded-xl hover:bg-gray-600 transition-colors">
        Reset
      </button>
    </div>

    <!-- Exercise List -->
    <div class="bg-gray-50 rounded-xl p-4">
      <h2 class="text-lg font-semibold mb-3 text-gray-700">Exercises</h2>
      <div class="space-y-2">
        <% @exercise_set.exercise_items.each_with_index do |item, index| %>
          <div data-timer-target="exerciseListItem" data-index="<%= index %>"
               class="flex justify-between items-center p-2 rounded <%= index == 0 ? 'bg-blue-100' : 'bg-white' %>">
            <span class="font-medium"><%= item.name %></span>
            <span class="text-sm text-gray-500"><%= item.exercise_seconds %>s / <%= item.rest_seconds %>s rest</span>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% elsif @exercise_sets.any? %>
  <div class="max-w-md mx-auto p-4">
    <!-- Header -->
    <div class="flex items-center mb-6">
      <%= link_to root_path, class: "p-2 hover:bg-gray-100 rounded" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      <% end %>
      <h1 class="text-2xl font-bold flex-1 text-center mr-8">Select Preset</h1>
    </div>

    <!-- Preset List -->
    <div class="space-y-3">
      <% @exercise_sets.each do |es| %>
        <a href="<%= timer_with_set_path(es) %>" class="block bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-semibold text-gray-900"><%= es.name %></h2>
              <div class="text-sm text-gray-500">
                <%= pluralize(es.rounds, "round") %> ãƒ»
                <%= pluralize(es.exercise_items.size, "exercise") %>
              </div>
            </div>
            <div class="p-2 bg-green-500 text-white rounded-full">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
          </div>
        </a>
      <% end %>
    </div>

    <!-- Manage Presets Link -->
    <div class="mt-6 text-center">
      <%= link_to "Manage Presets", exercise_sets_path, class: "text-blue-500 hover:underline" %>
    </div>
  </div>
<% else %>
  <div class="max-w-md mx-auto p-4">
    <!-- Header -->
    <div class="flex items-center mb-6">
      <%= link_to root_path, class: "p-2 hover:bg-gray-100 rounded" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      <% end %>
      <h1 class="text-2xl font-bold flex-1 text-center mr-8">Interval Timer</h1>
    </div>

    <!-- Empty State -->
    <div class="text-center py-12">
      <div class="mb-4">
        <svg class="w-16 h-16 mx-auto text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <p class="text-gray-500 mb-6">No exercise presets yet.<br>Create your first preset to start training!</p>
      <%= link_to new_exercise_set_path, class: "inline-block px-6 py-3 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors" do %>
        Create Preset
      <% end %>
    </div>
  </div>
<% end %>
