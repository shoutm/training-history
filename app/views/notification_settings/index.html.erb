<div class="max-w-md mx-auto px-4 py-6">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-xl font-bold">Notification Settings</h1>
    <%= link_to root_path, class: "text-blue-500" do %>
      Back
    <% end %>
  </div>

  <div class="bg-white rounded-lg shadow p-4 mb-6"
       data-controller="push-notification"
       data-push-notification-vapid-public-key-value="<%= Rails.application.credentials.dig(:vapid, :public_key) %>">
    <h2 class="font-semibold mb-3">Push Notifications</h2>
    <p class="text-sm text-gray-600 mb-4" data-push-notification-target="status">Checking...</p>
    <button type="button"
            data-push-notification-target="subscribeBtn"
            data-action="push-notification#subscribe"
            class="hidden px-4 py-2 bg-blue-500 text-white rounded-lg text-sm">
      Enable Notifications
    </button>
    <button type="button"
            data-push-notification-target="unsubscribeBtn"
            data-action="push-notification#unsubscribe"
            class="hidden px-4 py-2 bg-gray-500 text-white rounded-lg text-sm">
      Disable Notifications
    </button>
  </div>

  <% if @has_subscription %>
    <%= form_with url: bulk_update_notification_settings_path, method: :patch, class: "bg-white rounded-lg shadow" do |f| %>
      <h2 class="font-semibold p-4 border-b">Schedule by Day</h2>
      <div class="divide-y">
        <% @notification_settings.each do |setting| %>
          <div class="p-4 flex items-center justify-between" data-controller="notification-setting">
            <div class="flex items-center gap-3">
              <label class="relative inline-flex items-center cursor-pointer">
                <%= check_box_tag "settings[#{setting.id}][enabled]", "1", setting.enabled?,
                    class: "sr-only peer",
                    id: "enabled_#{setting.id}" %>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
              </label>
              <span class="font-medium w-8"><%= setting.day_name %></span>
            </div>
            <div class="flex items-center gap-2">
              <input type="time"
                     class="border rounded px-2 py-1 text-sm"
                     data-notification-setting-target="timeInput"
                     data-action="change->notification-setting#updateHidden">
              <%= hidden_field_tag "settings[#{setting.id}][notify_at_utc]",
                  setting.notify_at_utc&.strftime("%H:%M"),
                  data: { notification_setting_target: "hiddenInput" } %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="p-4 border-t">
        <%= f.submit "Save", class: "w-full px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600" %>
      </div>
    <% end %>
  <% else %>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-sm text-yellow-800">
      Enable push notifications above to configure your schedule.
    </div>
  <% end %>
</div>
